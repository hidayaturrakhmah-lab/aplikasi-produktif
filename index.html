<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Be Productive - Time & Money Management</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="https://i.imgur.com/v3d5wQ7.png">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-database-compat.js"></script>
    <style>
        /* --- COLOR & THEME VARIABLES (MODERN) --- */
        :root {
            /* Light Mode Colors */
            --bg-primary: linear-gradient(135deg, #FFD1DC, #FFFACD, #C9E4FF);
            --bg-card: rgba(255, 255, 255, 0.8);
            --bg-card-hover: rgba(255, 255, 255, 0.95);
            --text-primary: #333;
            --text-secondary: #555;
            --text-muted: #777;
            --border-color: rgba(0, 0, 0, 0.08);
            --shadow-light: 0 4px 15px rgba(0, 0, 0, 0.06);
            --shadow-medium: 0 8px 25px rgba(31, 38, 135, 0.12);
            --shadow-strong: 0 15px 35px rgba(31, 38, 135, 0.2);
            
            /* Theme Colors */
            --color-pink: #FFB6C1;
            --color-yellow: #FFFACD;
            --color-blue: #C9E4FF;
            --color-green: #C1E1C1;
            --color-purple: #E6E6FA;
        }

        /* Dark Mode Colors */
        [data-theme="dark"] {
            --bg-primary: linear-gradient(135deg, #1a1a2e, #16213e, #0f3460);
            --bg-card: rgba(30, 30, 46, 0.8);
            --bg-card-hover: rgba(40, 40, 60, 0.9);
            --text-primary: #f0f0f0;
            --text-secondary: #d0d0d0;
            --text-muted: #a0a0a0;
            --border-color: rgba(255, 255, 255, 0.1);
            --shadow-light: 0 4px 15px rgba(0, 0, 0, 0.3);
            --shadow-medium: 0 8px 25px rgba(0, 0, 0, 0.4);
            --shadow-strong: 0 15px 35px rgba(0, 0, 0, 0.5);

            /* Adjusted theme colors for dark mode */
            --color-pink: #d47a9a;
            --color-yellow: #e4e4a0;
            --color-blue: #7a9fd4;
            --color-green: #8fb88f;
            --color-purple: #b89fd4;
        }

        /* --- RESET & BASIC STYLES --- */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: var(--bg-primary);
            background-attachment: fixed;
            color: var(--text-primary);
            min-height: 100vh;
            margin: 0;
            transition: background 0.3s ease, color 0.3s ease;
        }
        
        .container {
            width: 100%;
            max-width: 1000px;
            padding: 0 20px;
            margin: 0 auto;
        }

        /* --- AUTH SCREEN (LOGIN/REGISTER) --- */
        #auth-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        
        .auth-toggle {
            display: flex;
            background: var(--bg-card);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 5px;
            margin-bottom: 20px;
            box-shadow: var(--shadow-light);
        }

        .auth-toggle button {
            flex: 1;
            padding: 12px;
            border: none;
            background: transparent;
            color: var(--text-secondary);
            font-family: 'Poppins', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            border-radius: 10px;
            transition: all 0.3s ease;
        }

        .auth-toggle button.active {
            background: var(--color-blue);
            color: #fff;
            box-shadow: var(--shadow-light);
        }

        .glass-card {
            background: var(--bg-card);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: var(--shadow-medium);
            padding: 40px;
            text-align: center;
            width: 100%;
            max-width: 450px;
            border: 1px solid var(--border-color);
        }
        
        .glass-card h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
            color: var(--text-primary);
        }
        
        .glass-card p {
            color: var(--text-muted);
            margin-bottom: 30px;
        }

        .input-group {
            position: relative;
            margin-bottom: 20px;
            text-align: left;
        }

        .input-group input {
            width: 100%;
            padding: 15px;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            background: var(--bg-card);
            font-family: 'Poppins', sans-serif;
            font-size: 1rem;
            color: var(--text-primary);
            transition: all 0.3s ease;
        }
        .input-group input:focus {
            outline: none;
            border-color: var(--color-blue);
            box-shadow: 0 0 0 3px rgba(201, 228, 255, 0.3);
        }
        
        .password-toggle {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            font-size: 1.2rem;
            color: var(--text-muted);
        }

        .btn-primary {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 12px;
            background: linear-gradient(90deg, var(--color-blue), var(--color-pink));
            color: #fff;
            font-family: 'Poppins', sans-serif;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-light);
        }
        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-medium);
        }
        
        .error-message {
            color: #ff4757;
            font-size: 0.9rem;
            margin-top: 10px;
            display: none;
        }

        /* --- MAIN APP (HIDDEN BY DEFAULT) --- */
        #main-app {
            display: none;
            width: 100%;
            min-height: 100vh;
        }
        
        /* --- HEADER & NAVIGATION (MODERN) --- */
        header {
            background: var(--bg-card);
            backdrop-filter: blur(15px);
            box-shadow: var(--shadow-light);
            padding: 15px 0;
            margin-bottom: 30px;
            border-radius: 0 0 20px 20px;
            border: 1px solid var(--border-color);
            border-top: none;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            max-width: 1000px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        .profile-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .profile-picture {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid var(--color-blue);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .profile-picture:hover {
            transform: scale(1.05) rotate(3deg);
            box-shadow: var(--shadow-medium);
        }
        .profile-info {
            display: flex;
            flex-direction: column;
        }
        .profile-username {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        h1 {
            color: var(--text-primary);
            font-weight: 700;
            font-size: 1.8rem;
            margin: 0;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        nav ul {
            list-style: none;
            display: flex;
            gap: 10px;
        }

        nav button, .btn-logout {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-family: 'Poppins', sans-serif;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            padding: 10px 15px;
            border-radius: 10px;
            transition: all 0.3s ease;
        }

        nav button:hover, .btn-logout:hover {
            background-color: var(--color-yellow);
            color: var(--text-primary);
            transform: translateY(-2px);
        }

        nav button.active {
            background-color: var(--color-blue);
            color: #fff;
            box-shadow: var(--shadow-light);
        }
        
        /* MODERN: Theme Toggle Switch */
        .theme-switch-wrapper {
            display: flex;
            align-items: center;
        }
        .theme-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }
        .theme-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }
        .slider:before {
            position: absolute;
            content: "üåû";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }
        input:checked + .slider {
            background-color: var(--color-purple);
        }
        input:checked + .slider:before {
            transform: translateX(26px);
            content: "üåô";
        }

        /* --- MAIN CONTENT --- */
        main {
            flex-grow: 1;
        }

        .content-section {
            display: none;
            animation: fadeIn 0.5s ease-in-out;
        }

        .content-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card {
            background: var(--bg-card);
            backdrop-filter: blur(10px);
            padding: 25px;
            border-radius: 20px;
            box-shadow: var(--shadow-light);
            margin-bottom: 25px;
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-medium);
        }

        .card h2 {
            color: var(--text-primary);
            margin-bottom: 20px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* --- DASHBOARD --- */
        #dashboard .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            align-items: start;
        }

        #dashboard .welcome-card {
            grid-column: 1 / -1;
        }

        /* NEW: Image Gallery Styles */
        .image-gallery-container {
            margin-bottom: 20px;
        }
        .image-gallery {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }
        .gallery-item {
            position: relative;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: var(--shadow-light);
            flex-basis: calc(33.333% - 10px);
            max-width: 200px;
            aspect-ratio: 1 / 1;
            transition: transform 0.3s ease;
        }
        .gallery-item:hover {
            transform: scale(1.05);
        }
        .gallery-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .delete-image-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(255, 255, 255, 0.8);
            color: var(--text-primary);
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: background 0.3s ease;
        }
        .delete-image-btn:hover {
            background: rgba(255, 0, 0, 0.7);
            color: white;
        }
        .add-image-btn {
            background: var(--color-blue);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 12px;
            cursor: pointer;
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-light);
        }
        .add-image-btn:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-medium);
        }
        #image-input {
            display: none;
        }

        #dashboard h2 {
            font-size: 2rem;
            text-align: center;
            color: var(--text-primary);
        }
        #dashboard p {
            text-align: center;
            font-size: 1.1rem;
            color: var(--text-secondary);
            margin-bottom: 10px;
        }
        
        .motto {
            text-align: center;
            font-style: italic;
            color: var(--text-muted);
            font-size: 1rem;
        }
        
        .clock-calendar-card {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        #live-clock {
            font-size: 2.5rem;
            font-weight: 300;
            color: var(--text-primary);
            margin-bottom: 20px;
        }

        #calendar-container {
            width: 100%;
            font-family: 'Poppins', sans-serif;
        }

        #calendar-container table {
            width: 100%;
            border-collapse: collapse;
            text-align: center;
        }

        #calendar-container th {
            padding: 8px 5px;
            font-weight: 600;
            color: var(--text-secondary);
            font-size: 0.8rem;
        }

        #calendar-container td {
            padding: 8px 5px;
            font-size: 0.9rem;
            color: var(--text-primary);
        }
        
        #calendar-container .today {
            background-color: var(--color-blue);
            color: #fff;
            font-weight: 700;
            border-radius: 50%;
        }
        
        #calendar-container .birthday {
            background-color: var(--color-pink);
            color: #fff;
            font-weight: 700;
            border-radius: 50%;
        }

        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
        }
        .summary-card {
            text-align: center;
            padding: 20px;
            border-radius: 15px;
            background: var(--bg-card);
            box-shadow: var(--shadow-light);
            transition: all 0.3s ease;
            border: 1px solid var(--border-color);
        }
        .summary-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-medium);
        }
        .summary-card h3 { font-weight: 500; color: var(--text-secondary); font-size: 0.9rem;}
        .summary-card p { font-size: 1.5rem; font-weight: 700; color: var(--text-primary); }
        .summary-card.work { background-color: var(--color-blue); }
        .summary-card.study { background-color: var(--color-pink); }
        .summary-card.read { background-color: var(--color-yellow); }
        .summary-card.film { background-color: var(--color-purple); }
        .summary-card.workout { background-color: var(--color-green); }
        
        /* --- BIRTHDAY CARD (SUPER AESTHETIC) --- */
        .birthday-card {
            text-align: center;
            padding: 0;
            border-radius: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #fecfef 75%, #fecfef 100%);
            color: #fff;
            position: relative;
            overflow: hidden;
            box-shadow: var(--shadow-strong);
            min-height: 280px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        
        .birthday-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: float 6s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
        }
        
        .birthday-header {
            padding: 25px 20px 15px;
            position: relative;
            z-index: 2;
        }
        
        .birthday-card h3 {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
            background: linear-gradient(45deg, #fff, #ffd1dc);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .cake-emoji {
            font-size: 3rem;
            animation: bounce 2s infinite;
            display: block;
            margin: 10px 0;
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0) scale(1); }
            40% { transform: translateY(-15px) scale(1.1); }
            60% { transform: translateY(-7px) scale(1.05); }
        }
        
        .birthday-content {
            padding: 0 20px 20px;
            position: relative;
            z-index: 2;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .birthday-display {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 15px;
            margin: 15px 0;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .birthday-display-text {
            font-size: 1.1rem;
            font-weight: 600;
            color: #fff;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
        }
        
        .edit-birthday-btn {
            background: linear-gradient(45deg, rgba(255,255,255,0.9), rgba(255,255,255,0.7));
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            color: #764ba2;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-light);
            position: relative;
            z-index: 2;
            margin-top: 10px;
        }
        
        .edit-birthday-btn:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-medium);
        }
        
        .birthday-notification {
            background: linear-gradient(135deg, rgba(255,255,255,0.95), rgba(255,255,255,0.85));
            color: #764ba2;
            border-radius: 20px;
            padding: 20px;
            margin-top: 15px;
            box-shadow: var(--shadow-medium);
            position: relative;
            z-index: 2;
            animation: slideInUp 0.5s ease-out;
            border: 2px solid rgba(118, 75, 162, 0.1);
        }
        
        @keyframes slideInUp {
            from { 
                opacity: 0; 
                transform: translateY(30px); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0); 
            }
        }
        
        .notification-title {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 10px;
            color: #764ba2;
        }
        
        .notification-message {
            font-size: 0.95rem;
            line-height: 1.6;
            color: #555;
            font-style: italic;
        }
        
        .sparkle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: white;
            border-radius: 50%;
            animation: sparkle 3s linear infinite;
        }
        
        @keyframes sparkle {
            0% { 
                opacity: 0; 
                transform: scale(0) rotate(0deg); 
            }
            50% { 
                opacity: 1; 
                transform: scale(1) rotate(180deg); 
            }
            100% { 
                opacity: 0; 
                transform: scale(0) rotate(360deg); 
            }
        }
        
        .birthday-decoration {
            position: absolute;
            font-size: 1.5rem;
            animation: float 4s ease-in-out infinite;
        }
        
        .decoration-1 { top: 10%; left: 10%; animation-delay: 0s; }
        .decoration-2 { top: 15%; right: 15%; animation-delay: 1s; }
        .decoration-3 { bottom: 20%; left: 20%; animation-delay: 2s; }
        .decoration-4 { bottom: 15%; right: 10%; animation-delay: 3s; }

        /* --- TIME MANAGEMENT --- */
        .timer-display {
            font-size: 3rem;
            font-weight: 300;
            text-align: center;
            margin: 20px 0;
            color: var(--text-primary);
        }

        .activity-selector-group {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .activity-btn {
            padding: 12px 22px;
            border: 2px solid var(--border-color);
            background: var(--bg-card);
            border-radius: 12px;
            font-family: 'Poppins', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--text-secondary);
        }

        .activity-btn.active {
            background-color: var(--color-blue);
            color: #fff;
            border-color: var(--color-blue);
            box-shadow: var(--shadow-light);
        }
        
        .activity-btn:hover {
            transform: scale(1.05);
        }

        .timer-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 12px;
            font-family: 'Poppins', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #fff;
            box-shadow: var(--shadow-light);
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .btn-primary { background-color: var(--color-blue); }
        .btn-stop { background-color: #ff6b6b; }
        .btn-reset { background-color: var(--text-muted); }

        .btn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: var(--shadow-medium);
        }

        .progress-container {
            margin-top: 20px;
        }
        .progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-secondary);
        }
        .progress-bar {
            width: 100%;
            height: 25px;
            background-color: var(--border-color);
            border-radius: 15px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            width: 0%;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-size: 0.8rem;
        }
        .progress-fill.work { background: linear-gradient(90deg, var(--color-blue), #6A9BD1); }
        .progress-fill.study { background: linear-gradient(90deg, var(--color-pink), #FFB6C1); }
        .progress-fill.read { background: linear-gradient(90deg, var(--color-yellow), #F0E68C); color: var(--text-primary); }
        .progress-fill.film { background: linear-gradient(90deg, var(--color-purple), #DDA0DD); color: var(--text-primary); }
        .progress-fill.workout { background: linear-gradient(90deg, var(--color-green), #90EE90); }
        
        /* --- TIME MANAGEMENT HISTORY (AESTHETIC) --- */
        .history-section {
            margin-top: 30px;
        }
        
        .history-toggle-btn {
            background: linear-gradient(135deg, var(--color-pink), var(--color-yellow));
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            font-size: 1.1rem;
            color: var(--text-primary);
            transition: all 0.3s ease;
            box-shadow: var(--shadow-light);
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 0 auto 20px;
        }
        
        .history-toggle-btn:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-medium);
        }
        
        .history-content {
            display: none;
            animation: slideDown 0.5s ease-out;
        }
        
        .history-content.show {
            display: block;
        }
        
        @keyframes slideDown {
            from { 
                opacity: 0; 
                max-height: 0; 
            }
            to { 
                opacity: 1; 
                max-height: 2000px; 
            }
        }
        
        /* --- TODAY'S DATA TABLE --- */
        .today-data-card {
            background: var(--bg-card);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: var(--shadow-light);
            border: 1px solid var(--border-color);
        }
        
        .today-data-card h3 {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 20px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .today-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: var(--shadow-light);
        }
        
        .today-table thead {
            background: linear-gradient(135deg, var(--color-blue), var(--color-pink));
            color: white;
        }
        
        .today-table th {
            padding: 15px;
            text-align: left;
            font-weight: 600;
            font-size: 0.95rem;
        }
        
        .today-table td {
            padding: 15px;
            background: var(--bg-card);
            border-bottom: 1px solid var(--border-color);
            font-weight: 500;
        }
        
        .today-table tr:last-child td {
            border-bottom: none;
        }
        
        .activity-cell {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .activity-icon {
            width: 35px;
            height: 35px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }
        
        .activity-icon.work { background: rgba(201, 228, 255, 0.3); }
        .activity-icon.study { background: rgba(255, 209, 220, 0.3); }
        .activity-icon.read { background: rgba(255, 250, 205, 0.3); }
        .activity-icon.film { background: rgba(230, 230, 250, 0.3); }
        .activity-icon.workout { background: rgba(193, 225, 193, 0.3); }
        
        .duration-cell {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 1.1rem;
        }
        
        .progress-cell {
            width: 150px;
        }
        
        .mini-progress-bar {
            width: 100%;
            height: 8px;
            background: var(--border-color);
            border-radius: 4px;
            overflow: hidden;
        }
        
        .mini-progress-fill {
            height: 100%;
            transition: width 0.5s ease;
        }
        
        .mini-progress-fill.work { background: var(--color-blue); }
        .mini-progress-fill.study { background: var(--color-pink); }
        .mini-progress-fill.read { background: var(--color-yellow); }
        .mini-progress-fill.film { background: var(--color-purple); }
        .mini-progress-fill.workout { background: var(--color-green); }
        
        /* --- PRODUCTIVITY CHART --- */
        .chart-card {
            background: var(--bg-card);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: var(--shadow-light);
            border: 1px solid var(--border-color);
        }
        
        .chart-card h3 {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 20px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .chart-container {
            position: relative;
            height: 300px;
            margin: 20px 0;
        }
        
        .chart-canvas {
            width: 100%;
            height: 100%;
        }
        
        .chart-legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        .legend-color {
            width:16px;
            height:16px;
            border-radius:4px;
        }
        
        /* --- DAILY HISTORY TABLE --- */
        .history-table-card {
            background: var(--bg-card);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            box-shadow: var(--shadow-light);
            border: 1px solid var(--border-color);
        }
        
        .history-table-card h3 {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 20px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .history-table-wrapper {
            max-height: 400px;
            overflow-y: auto;
            border-radius: 10px;
            box-shadow: var(--shadow-light);
        }
        
        .history-table-wrapper::-webkit-scrollbar {
            width: 8px;
        }
        
        .history-table-wrapper::-webkit-scrollbar-track {
            background: var(--bg-card);
            border-radius: 10px;
        }
        
        .history-table-wrapper::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, var(--color-pink), var(--color-blue));
            border-radius: 10px;
        }
        
        .history-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
        }
        
        .history-table thead {
            background: linear-gradient(135deg, var(--color-pink), var(--color-yellow));
            color: white;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .history-table th {
            padding: 15px;
            text-align: left;
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        .history-table td {
            padding: 12px 15px;
            background: var(--bg-card);
            border-bottom: 1px solid var(--border-color);
            font-weight: 500;
        }
        
        .history-table tbody tr:hover td {
            background: var(--bg-card-hover);
        }
        
        .date-cell {
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .total-time-cell {
            font-weight: 700;
            color: var(--text-primary);
            background: linear-gradient(135deg, rgba(201,228,255,0.3), rgba(255,209,220,0.3));
        }
        
        .empty-history {
            text-align: center;
            padding: 40px;
            color: var(--text-muted);
            font-style: italic;
        }
        
        .empty-history-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            opacity: 0.5;
        }

        /* --- MONEY MANAGEMENT --- */
        .money-form {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .money-form input {
            flex-grow: 1;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            background: var(--bg-card);
            font-family: 'Poppins', sans-serif;
            font-size: 1rem;
            color: var(--text-primary);
        }
        .money-form button {
            padding: 12px 20px;
        }
        .btn-income { background-color: var(--color-green); }
        .btn-expense { background-color: var(--color-pink); }

        .summary-cards-finance {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        .summary-card-finance {
            text-align: center;
            padding: 20px;
            border-radius: 15px;
            background: var(--bg-card);
            box-shadow: var(--shadow-light);
            transition: all 0.3s ease;
            border: 1px solid var(--border-color);
        }
        .summary-card-finance:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-medium);
        }
        .summary-card-finance.income { background-color: var(--color-yellow); }
        .summary-card-finance.expense { background-color: var(--color-pink); }
        .summary-card-finance.balance { background-color: var(--color-blue); }
        .summary-card-finance h3 { font-weight: 500; color: var(--text-secondary); }
        .summary-card-finance p { font-size: 1.5rem; font-weight: 700; color: var(--text-primary); }

        .transaction-list {
            list-style: none;
        }
        .transaction-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid var(--border-color);
            transition: background 0.3s ease;
        }
        .transaction-item:hover {
            background: var(--bg-card-hover);
        }
        .transaction-item:last-child {
            border-bottom: none;
        }
        .transaction-details {
            flex-grow: 1;
        }
        .transaction-details .desc {
            font-weight: 600;
            color: var(--text-primary);
        }
        .transaction-details .cat {
            font-size: 0.8rem;
            color: var(--text-muted);
        }
        .transaction-date {
            font-size: 0.9rem;
            color: var(--text-muted);
            margin: 0 15px;
            white-space: nowrap;
        }
        .transaction-amount {
            font-weight: 700;
            white-space: nowrap;
        }
        .amount-income { color: #2E8B57; }
        .amount-expense { color: #DC143C; }

        /* --- PROFILE MODAL --- */
        .profile-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s ease;
        }

        .profile-modal-content {
            background-color: var(--bg-card);
            border-radius: 20px;
            padding: 20px;
            max-width: 90%;
            max-height: 90%;
            text-align: center;
            position: relative;
            box-shadow: var(--shadow-strong);
        }

        .profile-modal-image {
            max-width: 100%;
            max-height: 70vh;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .profile-modal-actions {
            display: flex;
            justify-content: center;
            gap: 15px;
        }

        .close-modal {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 28px;
            font-weight: bold;
            color: var(--text-primary);
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .close-modal:hover {
            color: var(--text-muted);
        }
        
        /* --- BIRTHDAY MODAL --- */
        .birthday-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s ease;
        }

        .birthday-modal-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 20px;
            padding: 30px;
            max-width: 400px;
            width: 90%;
            text-align: center;
            position: relative;
            color: white;
            box-shadow: var(--shadow-strong);
        }

        .birthday-modal h3 {
            margin-bottom: 20px;
            color: white;
            font-size: 1.5rem;
        }

        .birthday-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .birthday-form input {
            padding: 12px;
            border: 1px solid rgba(255,255,255,0.3);
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.9);
            font-family: 'Poppins', sans-serif;
            font-size: 1rem;
        }

        .birthday-form-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
        }
        
        /* --- FIX: Helper class to hide elements --- */
        .hidden {
            display: none !important;
            visibility: hidden !important;
        }

        /* --- RESPONSIVE DESIGN --- */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            h1 {
                font-size: 1.5rem;
            }
            nav ul {
                flex-wrap: wrap;
                justify-content: center;
            }
            nav button, .btn-logout {
                font-size: 0.9rem;
                padding: 8px 12px;
            }
            .card {
                padding: 20px;
            }
            .card h2 {
                font-size: 1.3rem;
            }
            #dashboard .dashboard-grid {
                grid-template-columns: 1fr;
            }
            #dashboard h2 {
                font-size: 1.5rem;
            }
            #live-clock {
                font-size: 2rem;
            }
            .summary-cards {
                grid-template-columns: 1fr 1fr;
            }
            .summary-card p {
                font-size: 1.2rem;
            }
            .timer-display {
                font-size: 2.5rem;
            }
            .activity-selector-group {
                flex-direction: column;
                align-items: center;
            }
            .activity-btn {
                width: 80%;
                justify-content: center;
            }
            .timer-controls {
                flex-direction: column;
                gap: 10px;
            }
            .btn {
                width: 100%;
            }
            .money-form {
                flex-direction: column;
            }
            .money-form input {
                margin-bottom: 10px;
            }
            .summary-cards-finance {
                grid-template-columns: 1fr;
            }
            .gallery-item {
                flex-basis: calc(50% - 10px);
            }
            .birthday-card {
                min-height: 250px;
            }
            .birthday-card h3 {
                font-size: 1.5rem;
            }
            .cake-emoji {
                font-size: 2.5rem;
            }
            
            /* Responsive for tables */
            .today-table, .history-table {
                font-size: 0.85rem;
            }
            
            .today-table th, .today-table td, 
            .history-table th, .history-table td {
                padding: 10px;
            }
            
            .activity-icon {
                width: 30px;
                height: 30px;
                font-size: 1rem;
            }
            
            .progress-cell {
                width: 100px;
            }
            
            .chart-container {
                height: 250px;
            }
            
            .chart-legend {
                gap: 10px;
            }
            
            /* Responsive for transactions */
            .transaction-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
            }
            
            .transaction-date {
                margin: 5px 0;
            }
        }
    </style>
</head>
<body>

    <!-- AUTH SCREEN (LOGIN/REGISTER) -->
    <div id="auth-container">
        <div class="glass-card">
            <div class="auth-toggle">
                <button id="show-login" class="active">Login</button>
                <button id="show-register">Register</button>
            </div>

            <div id="login-card">
                <h1>üå∏ Hello! üå∏</h1>
                <p>Welcome back.</p>
                <form id="login-form">
                    <div class="input-group">
                        <input type="text" id="login-username" placeholder="Username" required>
                    </div>
                    <div class="input-group">
                        <input type="password" id="login-password" placeholder="Password" required>
                        <span class="password-toggle" data-target="login-password">üëÅÔ∏è</span>
                    </div>
                    <button type="submit" class="btn-primary">Login</button>
                    <p class="error-message" id="login-error">Incorrect username or password.</p>
                </form>
            </div>

            <div id="register-card" style="display: none;">
                <h1>‚ú® Join! ‚ú®</h1>
                <p>Let's start your productive journey.</p>
                <form id="register-form">
                    <div class="input-group">
                        <input type="text" id="register-username" placeholder="Create Username" required>
                    </div>
                    <div class="input-group">
                        <input type="password" id="register-password" placeholder="Create Password" required>
                        <span class="password-toggle" data-target="register-password">üëÅÔ∏è</span>
                    </div>
                    <div class="input-group">
                        <input type="password" id="register-confirm-password" placeholder="Confirm Password" required>
                        <span class="password-toggle" data-target="register-confirm-password">üëÅÔ∏è</span>
                    </div>
                    <button type="submit" class="btn-primary">Register</button>
                    <p class="error-message" id="register-error">Incorrect password or user already exists.</p>
                </form>
            </div>
        </div>
    </div>

    <!-- MAIN APPLICATION (HIDDEN UNTIL LOGIN) -->
    <div id="main-app">
        <header>
            <div class="header-content">
                <div class="profile-section">
                    <img id="profile-picture" class="profile-picture" src="https://i.imgur.com/gL1hLhA.png" alt="Profile Picture">
                    <div class="profile-info">
                        <h1>üå∏ Be Productive! üå∏</h1>
                    </div>
                </div>
                <div class="header-actions">
                    <nav>
                        <ul>
                            <li><button class="nav-link active" data-target="dashboard">Home</button></li>
                            <li><button class="nav-link" data-target="time-management">‚è∞ Time</button></li>
                            <li><button class="nav-link" data-target="money-management">üí∞ Money</button></li>
                        </ul>
                    </nav>
                    <!-- MODERN: Theme Toggle Switch -->
                    <div class="theme-switch-wrapper">
                        <label class="theme-switch">
                            <input type="checkbox" id="theme-toggle">
                            <span class="slider"></span>
                        </label>
                    </div>
                    <button class="btn-logout">Logout</button>
                </div>
            </div>
        </header>

        <!-- PROFILE PICTURE MODAL -->
        <div id="profile-modal" class="profile-modal">
            <div class="profile-modal-content">
                <span class="close-modal">&times;</span>
                <img id="profile-modal-image" class="profile-modal-image" src="" alt="Profile Picture">
                <div class="profile-modal-actions">
                    <button id="change-profile-btn" class="btn btn-primary">Change Profile Picture</button>
                </div>
            </div>
        </div>
        
        <!-- BIRTHDAY MODAL -->
        <div id="birthday-modal" class="birthday-modal">
            <div class="birthday-modal-content">
                <span class="close-modal" id="close-birthday-modal">&times;</span>
                <h3>üéÇ Birthday</h3>
                <form class="birthday-form" id="birthday-form">
                    <input type="date" id="birthday-input" required>
                    <div class="birthday-form-buttons">
                        <button type="submit" class="btn btn-primary">Save</button>
                        <button type="button" class="btn btn-reset" id="cancel-birthday-btn">Cancel</button>
                    </div>
                </form>
            </div>
        </div>

        <main class="container">
            <!-- DASHBOARD SECTION -->
            <section id="dashboard" class="content-section active">
                <div class="dashboard-grid">
                    <div class="card welcome-card">
                                <h1 style="text-align: center; font-size: 1.3rem; font-weight: 700; color: var(--text-primary)">Image Galleryüì∏</h1><br>
                        <!-- NEW: Image Gallery Container -->
                        <div class="image-gallery-container">
                            <div id="image-gallery" class="image-gallery">
                                <!-- Images will be loaded here by JavaScript -->
                            </div>
                            <br><button class="add-image-btn" id="add-image-btn">+ Add Image</button>
                            <input type="file" id="image-input" accept="image/*">
                        </div>
                        
                        <h2 id="welcome-message">Hello, ! ‚ú®</h2>
                        <p>It's time to make today more meaningful. Come on, achieve your goals one by one!</p>
                        <p class="motto">"Progress, not perfection, is key to success."</p>
                    </div>
                    <div class="card clock-calendar-card">
                        <div id="live-clock">00:00:00</div>
                        <div id="calendar-container"></div>
                    </div>
                    <!-- BIRTHDAY CARD (SUPER AESTHETIC) -->
                    <div class="card birthday-card" id="birthday-card">
                        <div class="birthday-decoration decoration-1">üåü</div>
                        <div class="birthday-decoration decoration-2">‚ú®</div>
                        <div class="birthday-decoration decoration-3">üéà</div>
                        <div class="birthday-decoration decoration-4">üéâ</div>
                        
                        <div class="birthday-header">
                            <h3>üéÇ Your Special Day</h3>
                            <div class="cake-emoji">üéÇ</div>
                        </div>
                        
                        <div class="birthday-content">
                            <div class="birthday-display">
                                <div class="birthday-display-text" id="birthday-display-text">Add birthday</div>
                            </div>
                            <button class="edit-birthday-btn" id="edit-birthday-btn">‚ú® Set Date</button>
                            <div id="birthday-notification" class="birthday-notification" style="display: none;"></div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="summary-cards">
                            <div class="summary-card work">
                                <h3>üíº Work</h3>
                                <p>Max. 8 hours</p>
                            </div>
                            <div class="summary-card study">
                                <h3>üìö Study</h3>
                                <p>Min. 30 Minutes</p>
                            </div>
                            <div class="summary-card read">
                                <h3>üìñ Reading</h3>
                                <p>Target Free</p>
                            </div>
                            <div class="summary-card film">
                                <h3>üé¨ Movie</h3>
                                <p>Target Free</p>
                            </div>
                            <div class="summary-card workout">
                                <h3>üí™ Workout</h3>
                                <p>Target Free</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- TIME MANAGEMENT SECTION -->
            <section id="time-management" class="content-section">
                <div class="card">
                    <h2>‚è∞ Time Management</h2>
                    <div class="activity-selector-group">
                        <button class="activity-btn active" data-activity="work">üíº Work</button>
                        <button class="activity-btn" data-activity="study">üìö Study</button>
                        <button class="activity-btn" data-activity="read">üìñ Reading</button>
                        <button class="activity-btn" data-activity="film">üé¨ Movie</button>
                        <button class="activity-btn" data-activity="workout">üí™ Workout</button>
                    </div>
                    <div class="timer-display" id="timer-display">00:00:00</div>
                    <div class="timer-controls">
                        <button class="btn btn-primary" id="start-pause-btn">Start</button>
                        <button class="btn btn-stop" id="stop-timer-btn" disabled>Finish</button>
                        <button class="btn btn-reset" id="reset-day-btn">Reset Day</button>
                    </div>
                </div>
                <div class="card">
                    <h2>Daily Progress</h2>
                    <div class="progress-container">
                        <div class="progress-label">
                            <span>üíº Working Hours (Max: 8 Hours)</span>
                            <span id="work-time-text">0 Hours 0 Minutes</span>
                        </div>
                        <div class="progress-bar"><div class="progress-fill work" id="work-progress"></div></div>
                    </div>
                    <div class="progress-container">
                        <div class="progress-label">
                            <span>üìö Study Time (Min: 30 Minutes)</span>
                            <span id="study-time-text">0 Minutes</span>
                        </div>
                        <div class="progress-bar"><div class="progress-fill study" id="study-progress"></div></div>
                    </div>
                    <div class="progress-container">
                        <div class="progress-label">
                            <span>üìñ Reading Time</span>
                            <span id="read-time-text">0 Minutes</span>
                        </div>
                        <div class="progress-bar"><div class="progress-fill read" id="read-progress"></div></div>
                    </div>
                    <div class="progress-container">
                        <div class="progress-label">
                            <span>üé¨ Movie Time</span>
                            <span id="film-time-text">0 Minutes</span>
                        </div>
                        <div class="progress-bar"><div class="progress-fill film" id="film-progress"></div></div>
                    </div>
                    <div class="progress-container">
                        <div class="progress-label">
                            <span>üí™ Workout Time</span>
                            <span id="workout-time-text">0 Minutes</span>
                        </div>
                        <div class="progress-bar"><div class="progress-fill workout" id="workout-progress"></div></div>
                    </div>
                </div>
                
                <!-- TIME MANAGEMENT HISTORY (AESTHETIC) -->
                <div class="history-section">
                    <button class="history-toggle-btn" id="history-toggle-btn">
                        <span>üìä</span>
                        <span>View History & Statistics</span>
                        <span id="history-arrow">‚ñº</span>
                    </button>
                    
                    <div class="history-content" id="history-content">
                        <!-- TODAY'S DATA TABLE -->
                        <div class="today-data-card">
                            <h3>üìÖ Today's Data</h3>
                            <table class="today-table">
                                <thead>
                                    <tr>
                                        <th>Activity</th>
                                        <th>Duration</th>
                                        <th>Progress</th>
                                    </tr>
                                </thead>
                                <tbody id="today-table-body">
                                    <!-- Today's data will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- PRODUCTIVITY CHART -->
                        <div class="chart-card">
                            <h3>üìà 7-Day Productivity Chart</h3>
                            <div class="chart-container">
                                <canvas id="productivity-chart" class="chart-canvas"></canvas>
                            </div>
                            <div class="chart-legend" id="chart-legend">
                                <!-- Legend will be loaded here -->
                            </div>
                        </div>
                        
                        <!-- DAILY HISTORY TABLE -->
                        <div class="history-table-card">
                            <h3>üìù Daily History</h3>
                            <div class="history-table-wrapper">
                                <table class="history-table">
                                    <thead>
                                        <tr>
                                            <th>Date</th>
                                            <th>üíº Work</th>
                                            <th>üìö Study</th>
                                            <th>üìñ Reading</th>
                                            <th>üé¨ Movies</th>
                                            <th>üí™ Workout</th>
                                            <th>Total</th>
                                        </tr>
                                    </thead>
                                    <tbody id="history-table-body">
                                        <!-- History will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- MONEY MANAGEMENT SECTION -->
            <section id="money-management" class="content-section">
                <div class="card">
                    <h2>üí∞ Add Transaction</h2>
                    <form class="money-form" id="money-form">
                        <input type="number" id="amount" placeholder="Amount (Rp)" required>
                        <input type="text" id="description" placeholder="Description (e.g., Salary, Food)" required>
                        <button type="submit" class="btn btn-income" id="add-income">+ Income</button>
                        <button type="button" class="btn btn-expense" id="add-expense">- Expense</button>
                    </form>
                </div>
                <div class="card">
                    <h2>Financial Summary</h2>
                    <div class="summary-cards-finance">
                        <div class="summary-card-finance income">
                            <h3>Total Income</h3>
                            <p id="total-income">Rp 0</p>
                        </div>
                        <div class="summary-card-finance expense">
                            <h3>Total Expense</h3>
                            <p id="total-expense">Rp 0</p>
                        </div>
                        <div class="summary-card-finance balance">
                            <h3>Remaining Balance</h3>
                            <p id="total-balance">Rp 0</p>
                        </div>
                    </div>
                </div>
                <div class="card">
                    <h2>Transaction History</h2>
                    <ul class="transaction-list" id="transaction-list">
                        <li class="transaction-item">No transactions yet.</li>
                    </ul>
                </div>
            </section>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- MODERN: Theme Toggle Logic ---
            const themeToggle = document.getElementById('theme-toggle');
            const currentTheme = localStorage.getItem('theme');
            
            if (currentTheme) {
                document.documentElement.setAttribute('data-theme', currentTheme);
                if (currentTheme === 'dark') {
                    themeToggle.checked = true;
                }
            }

            function switchTheme(e) {
                if (e.target.checked) {
                    document.documentElement.setAttribute('data-theme', 'dark');
                    localStorage.setItem('theme', 'dark');
                } else {
                    document.documentElement.setAttribute('data-theme', 'light');
                    localStorage.setItem('theme', 'light');
                }    
            }

            themeToggle.addEventListener('change', switchTheme);

            // --- AUTH DOM ELEMENTS ---
            const authContainer = document.getElementById('auth-container');
            const mainApp = document.getElementById('main-app');
            const showLoginBtn = document.getElementById('show-login');
            const showRegisterBtn = document.getElementById('show-register');
            const loginCard = document.getElementById('login-card');
            const registerCard = document.getElementById('register-card');
            const loginForm = document.getElementById('login-form');
            const registerForm = document.getElementById('register-form');
            const loginError = document.getElementById('login-error');
            const registerError = document.getElementById('register-error');
            const passwordToggles = document.querySelectorAll('.password-toggle');

            // --- MAIN APP DOM ELEMENTS ---
            const welcomeMessage = document.getElementById('welcome-message');
            const logoutBtn = document.querySelector('.btn-logout');
            const navLinks = document.querySelectorAll('.nav-link');
            const sections = document.querySelectorAll('.content-section');
            const timerDisplay = document.getElementById('timer-display');
            const activityBtns = document.querySelectorAll('.activity-btn');
            const startPauseBtn = document.getElementById('start-pause-btn');
            const stopTimerBtn = document.getElementById('stop-timer-btn');
            const resetDayBtn = document.getElementById('reset-day-btn');
            const progressBars = { work: 'work-progress', study: 'study-progress', read: 'read-progress', film: 'film-progress', workout: 'workout-progress' };
            const timeTexts = { work: 'work-time-text', study: 'study-time-text', read: 'read-time-text', film: 'film-time-text', workout: 'workout-time-text' };
            const moneyForm = document.getElementById('money-form');
            const amountInput = document.getElementById('amount');
            const descriptionInput = document.getElementById('description');
            const addIncomeBtn = document.getElementById('add-income');
            const addExpenseBtn = document.getElementById('add-expense');
            const totalIncomeEl = document.getElementById('total-income');
            const totalExpenseEl = document.getElementById('total-expense');
            const totalBalanceEl = document.getElementById('total-balance');
            const transactionListEl = document.getElementById('transaction-list');

            // --- PROFILE DOM ELEMENTS ---
            const profilePicture = document.getElementById('profile-picture');
            const profileInput = document.createElement('input');
            profileInput.type = 'file';
            profileInput.id = 'profile-input';
            profileInput.style.display = 'none';
            document.body.appendChild(profileInput);
            
            // --- PROFILE MODAL DOM ELEMENTS ---
            const profileModal = document.getElementById('profile-modal');
            const profileModalImage = document.getElementById('profile-modal-image');
            const changeProfileBtn = document.getElementById('change-profile-btn');
            const closeModal = document.querySelector('.close-modal');
            
            // --- BIRTHDAY DOM ELEMENTS ---
            const birthdayDisplayText = document.getElementById('birthday-display-text');
            const editBirthdayBtn = document.getElementById('edit-birthday-btn');
            const birthdayModal = document.getElementById('birthday-modal');
            const birthdayForm = document.getElementById('birthday-form');
            const birthdayInput = document.getElementById('birthday-input');
            const closeBirthdayModal = document.getElementById('close-birthday-modal');
            const cancelBirthdayBtn = document.getElementById('cancel-birthday-btn');
            const birthdayNotification = document.getElementById('birthday-notification');
            const birthdayCard = document.getElementById('birthday-card');
            
            // --- TIME HISTORY DOM ELEMENTS ---
            const historyToggleBtn = document.getElementById('history-toggle-btn');
            const historyContent = document.getElementById('history-content');
            const historyArrow = document.getElementById('history-arrow');
            const todayTableBody = document.getElementById('today-table-body');
            const productivityChart = document.getElementById('productivity-chart');
            const chartLegend = document.getElementById('chart-legend');
            const historyTableBody = document.getElementById('history-table-body');

            // --- STATE & USER MANAGEMENT ---
            let currentUser = null;
            let firebaseDB = null;

            const activities = ['work', 'study', 'read', 'film', 'workout'];
            let totalSeconds = {};
            let lastResetDate = null;
            let transactions = [];
            // Array to store image dataURL
            let dashboardImages = [];
            // State for profile picture
            let profileImageUrl = 'https://i.imgur.com/gL1hLhA.png'; // Default placeholder
            // State for birthday date
            let birthdayDate = null;
            // State for alarm
            let birthdayAlarmShown = false;
            // State for daily time history
            let dailyHistory = [];

            // --- IMPORTANT: REPLACE WITH YOUR FIREBASE DATA ---
            const firebaseConfig = {
              apiKey: "AIzaSyCVGICoAkqzVxto9n9KLzIzLQk51M3WigM",
              authDomain: "akuproduktifapp-add18.firebaseapp.com",
              databaseURL: "https://akuproduktifapp-add18-default-rtdb.asia-southeast1.firebasedatabase.app",
              projectId: "akuproduktifapp-add18",
              storageBucket: "akuproduktifapp-add18.firebasestorage.app",
              messagingSenderId: "288070789908",
              appId: "1:288070789908:web:148ce057be72655151b001",
              measurementId: "G-S99FVJRXBZ"
            };

            // Initialize Firebase
            firebase.initializeApp(firebaseConfig);
            firebaseDB = firebase.database();

            // --- AUTH UI FUNCTIONS ---
            function showAuthScreen() {
                console.log('Showing auth screen...');
                authContainer.classList.remove('hidden');
                authContainer.style.display = 'flex';
                mainApp.style.display = 'none';
            }

            function showMainApp() {
                console.log('Showing main app...');
                authContainer.classList.add('hidden');
                mainApp.style.display = 'block';
            }

            function toggleAuthScreen(type) {
                if (type === 'login') {
                    loginCard.style.display = 'block';
                    registerCard.style.display = 'none';
                    showLoginBtn.classList.add('active');
                    showRegisterBtn.classList.remove('active');
                } else {
                    registerCard.style.display = 'block';
                    loginCard.style.display = 'none';
                    showRegisterBtn.classList.add('active');
                    showLoginBtn.classList.remove('active');
                }
                loginError.style.display = 'none';
                registerError.style.display = 'none';
            }

            // --- AUTH LOGIC FUNCTIONS ---
            function handleLogin(username, password) {
                firebaseDB.ref('users/' + username).once('value')
                    .then((snapshot) => {
                        const userData = snapshot.val();
                        if (userData && userData.password === password) {
                            currentUser = username;
                            localStorage.setItem('loggedInUser', currentUser);
                            console.log('Login successful for:', username);
                            showMainApp();
                            initializeUserData();
                        } else {
                            loginError.style.display = 'block';
                        }
                    })
                    .catch((error) => {
                        console.error("Login failed:", error);
                        loginError.style.display = 'block';
                    });
            }

            function handleRegister(username, password, confirmPassword) {
                if (password !== confirmPassword) {
                    registerError.textContent = 'Passwords do not match.';
                    registerError.style.display = 'block';
                    return;
                }
                
                firebaseDB.ref('users/' + username).once('value')
                    .then((snapshot) => {
                        if (snapshot.exists()) {
                            registerError.textContent = 'Username already exists.';
                            registerError.style.display = 'block';
                        } else {
                            firebaseDB.ref('users/' + username).set({
                                password: password
                            }).then(() => {
                                registerForm.reset();
                                toggleAuthScreen('login');
                                document.getElementById('login-username').value = username;
                                registerError.style.display = 'none';
                            }).catch((error) => {
                                console.error("Registration failed:", error);
                                registerError.textContent = 'An error occurred, please try again.';
                                registerError.style.display = 'block';
                            });
                        }
                    });
            }
            
            function logout() {
                currentUser = null;
                localStorage.removeItem('loggedInUser');
                showAuthScreen();
                loginForm.reset();
                registerForm.reset();
            }

            // --- AUTH EVENT LISTENERS ---
            showLoginBtn.addEventListener('click', () => toggleAuthScreen('login'));
            showRegisterBtn.addEventListener('click', () => toggleAuthScreen('register'));

            loginForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const username = document.getElementById('login-username').value.trim();
                const password = document.getElementById('login-password').value;
                handleLogin(username, password);
            });

            registerForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const username = document.getElementById('register-username').value.trim();
                const password = document.getElementById('register-password').value;
                const confirmPassword = document.getElementById('register-confirm-password').value;
                handleRegister(username, password, confirmPassword);
            });
            
            passwordToggles.forEach(toggle => {
                toggle.addEventListener('click', () => {
                    const targetId = toggle.dataset.target;
                    const input = document.getElementById(targetId);
                    if (input.type === 'password') {
                        input.type = 'text';
                        toggle.textContent = 'üôà';
                    } else {
                        input.type = 'password';
                        toggle.textContent = 'üëÅÔ∏è';
                    }
                });
            });

            logoutBtn.addEventListener('click', logout);

            // --- MAIN APP FUNCTIONS ---
            function initializeUserData() {
                console.log('Initializing user data...');
                welcomeMessage.textContent = `Hello, ${currentUser}! ‚ú®`;
                const userRef = firebaseDB.ref('userData/' + currentUser);
                
                userRef.on('value', (snapshot) => {
                    const data = snapshot.val() || {};
                    activities.forEach(act => {
                        totalSeconds[act] = data.totalSeconds?.[act] || 0;
                    });
                    lastResetDate = data.lastResetDate;
                    transactions = data.transactions || [];
                    // Get image data from Firebase
                    dashboardImages = data.dashboardImages || [];
                    // Get profile picture data from Firebase
                    profileImageUrl = data.profileImageUrl || 'https://i.imgur.com/gL1hLhA.png'; // Default placeholder
                    // Get birthday date from Firebase
                    birthdayDate = data.birthdayDate || null;
                    // Get alarm status
                    const today = new Date().toDateString();
                    birthdayAlarmShown = data.birthdayAlarmShown === today;
                    // Get daily time history
                    dailyHistory = data.dailyHistory || [];

                    checkAndResetDaily();
                    updateTimeDisplay();
                    updateProgressBar();
                    updateMoneySummary();
                    displayTransactions();
                    // Render image gallery
                    renderGallery();
                    // Render profile picture
                    renderProfilePicture();
                    // Render birthday date
                    renderBirthday();
                    // Check and show birthday notification
                    checkBirthdayNotification();
                    // Add sparkle effects
                    addSparkles();
                    // Render time history data
                    renderTimeHistory();
                });
            }
            
            // --- IMAGE GALLERY FUNCTIONS ---
            function renderGallery() {
                const imageGallery = document.getElementById('image-gallery');
                imageGallery.innerHTML = ''; // Empty first
                if (dashboardImages.length === 0) {
                    imageGallery.innerHTML = '<p style="text-align:center; color: var(--text-muted);">No images yet. Click "Add Image" to start.</p>';
                    return;
                }
                dashboardImages.forEach(image => {
                    const item = document.createElement('div');
                    item.className = 'gallery-item';
                    item.dataset.id = image.id;
                    
                    const img = document.createElement('img');
                    img.src = image.dataURL;
                    img.alt = 'Dashboard Image';
                    
                    const deleteBtn = document.createElement('button');
                    deleteBtn.className = 'delete-image-btn';
                    deleteBtn.innerHTML = '&times;';
                    deleteBtn.onclick = () => deleteImage(image.id);
                    
                    item.appendChild(img);
                    item.appendChild(deleteBtn);
                    imageGallery.appendChild(item);
                });
            }

            function addImage(e) {
                const file = e.target.files[0];
                if (file && dashboardImages.length < 3) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        const newImage = {
                            id: Date.now(), // Simple unique ID
                            dataURL: event.target.result
                        };
                        dashboardImages.push(newImage);
                        saveUserData();
                        renderGallery();
                    };
                    reader.readAsDataURL(file);
                } else if (dashboardImages.length >= 3) {
                    alert('Maximum 3 images can be added.');
                }
            }

            function deleteImage(id) {
                if (confirm('Are you sure you want to delete this image?')) {
                    dashboardImages = dashboardImages.filter(img => img.id !== id);
                    saveUserData();
                    renderGallery();
                }
            }
            
            // --- PROFILE PICTURE FUNCTIONS ---
            function renderProfilePicture() {
                profilePicture.src = profileImageUrl;
            }

            function openProfileModal() {
                profileModalImage.src = profileImageUrl;
                profileModal.style.display = 'flex';
            }

            function closeProfileModal() {
                profileModal.style.display = 'none';
            }

            function changeProfilePicture() {
                profileInput.click();
                closeProfileModal();
            }

            function handleProfilePictureChange(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        profileImageUrl = event.target.result;
                        saveUserData();
                        renderProfilePicture();
                    };
                    reader.readAsDataURL(file);
                }
            }
            
            // --- BIRTHDAY DATE FUNCTIONS ---
            function renderBirthday() {
                if (birthdayDate) {
                    const date = new Date(birthdayDate);
                    const options = { day: 'numeric', month: 'long', year: 'numeric' };
                    const formattedDate = date.toLocaleDateString('en-US', options);
                    birthdayDisplayText.textContent = formattedDate;
                } else {
                    birthdayDisplayText.textContent = 'Add birthday date';
                }
            }
            
            function openBirthdayModal() {
                birthdayModal.style.display = 'flex';
                if (birthdayDate) {
                    birthdayInput.value = birthdayDate;
                }
            }
            
            function closeBirthdayModalFunc() {
                birthdayModal.style.display = 'none';
            }
            
            function saveBirthday(e) {
                e.preventDefault();
                birthdayDate = birthdayInput.value;
                saveUserData();
                renderBirthday();
                checkBirthdayNotification();
                closeBirthdayModalFunc();
            }
            
            function checkBirthdayNotification() {
                if (!birthdayDate) {
                    birthdayNotification.style.display = 'none';
                    return;
                }
                
                const today = new Date();
                const birthday = new Date(birthdayDate);
                
                // Set birthday year to this year
                birthday.setFullYear(today.getFullYear());
                
                // Calculate days difference
                const diffTime = birthday - today;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                
                // Touching birthday messages
                const birthdayMessages = [
                    "Today is the day when flowers bloom beautifully, just like your smile that always colors the world. Happy birthday! üå∏",
                    "Every year is a new chapter in your life story. May this chapter be filled with happiness, love, and dreams come true. üéÇ",
                    "You are like a star that shines the brightest in the sky of many people's lives. Keep shining and making the world more beautiful. ‚ú®",
                    "Today is a celebration of your precious presence. Thank you for being an inspiration and happiness to many people. üéà",
                    "In your life's journey, you've written many beautiful stories. May this year be the best chapter in your storybook. üìñ",
                    "You are a miracle that continues to grow. Every day with you is an invaluable gift. Happy birthday! üéÅ",
                    "Like a cool breeze on a hot day, your presence always brings calm and happiness. May your day be as beautiful as your smile. üå∫",
                    "Today the world becomes brighter because you are in it. Continue to be a light for those around you. üåü"
                ];
                
                const countdownMessages = [
                    "Your special day is getting closer! Prepare your heart to receive lots of surprises and happiness! üéâ",
                    "Counting down to your birthday! May every second be filled with joy and new hopes. ‚è∞",
                    "Not long until the day you become the main star! Get ready for a day full of magic! üåü",
                    "Counting down to your birthday! May your preparations bring happiness that exceeds expectations. üéÇ",
                    "Countdown to your special day! Every day that passes brings you closer to happiness. üéà"
                ];
                
                // Show notification
                if (diffDays === 0) {
                    const randomMessage = birthdayMessages[Math.floor(Math.random() * birthdayMessages.length)];
                    birthdayNotification.innerHTML = `
                        <div class="notification-title">üéâ Happy Birthday! üéâ</div>
                        <div class="notification-message">${randomMessage}</div>
                    `;
                    birthdayNotification.style.display = 'block';
                } else if (diffDays > 0 && diffDays <= 7) {
                    const randomCountdown = countdownMessages[Math.floor(Math.random() * countdownMessages.length)];
                    birthdayNotification.innerHTML = `
                        <div class="notification-title">üéÇ ${diffDays} Days To Go! üéÇ</div>
                        <div class="notification-message">${randomCountdown}</div>
                    `;
                    birthdayNotification.style.display = 'block';
                } else {
                    birthdayNotification.style.display = 'none';
                }
            }
            
            function addSparkles() {
                if (!birthdayDate) return;
                
                const today = new Date();
                const birthday = new Date(birthdayDate);
                birthday.setFullYear(today.getFullYear());
                
                const diffTime = birthday - today;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                
                if (diffDays === 0) {
                    // Add sparkle effects
                    for (let i = 0; i < 15; i++) {
                        setTimeout(() => {
                            const sparkle = document.createElement('div');
                            sparkle.className = 'sparkle';
                            sparkle.style.left = Math.random() * 100 + '%';
                            sparkle.style.top = Math.random() * 100 + '%';
                            sparkle.style.animationDelay = Math.random() * 3 + 's';
                            birthdayCard.appendChild(sparkle);
                            
                            setTimeout(() => sparkle.remove(), 3000);
                        }, i * 200);
                    }
                }
            }
            
            // --- TABLE & CHART FUNCTIONS ---
            function formatDuration(seconds) {
                const hours = Math.floor(seconds / 3600);
                const minutes = Math.floor((seconds % 3600) / 60);
                if (hours > 0) {
                    return `${hours}h ${minutes}m`;
                } else {
                    return `${minutes}m`;
                }
            }
            
            function formatDurationShort(seconds) {
                const hours = Math.floor(seconds / 3600);
                const minutes = Math.floor((seconds % 3600) / 60);
                if (hours > 0) {
                    return `${hours}h ${minutes}m`;
                } else {
                    return `${minutes}m`;
                }
            }
            
            function formatDate(dateString) {
                const date = new Date(dateString);
                const options = { 
                    day: 'numeric', 
                    month: 'short', 
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                };
                return date.toLocaleDateString('en-US', options);
            }
            
            function getActivityIcon(activity) {
                const icons = {
                    work: 'üíº',
                    study: 'üìö',
                    read: 'üìñ',
                    film: 'üé¨',
                    workout: 'üí™'
                };
                return icons[activity] || '‚è∞';
            }
            
            function getActivityName(activity) {
                const names = {
                    work: 'Work',
                    study: 'Study',
                    read: 'Reading',
                    film: 'Movie',
                    workout: 'Workout'
                };
                return names[activity] || 'Activity';
            }
            
            function getActivityColor(activity) {
                const colors = {
                    work: '#C9E4FF',
                    study: '#FFD1DC',
                    read: '#FFFACD',
                    film: '#E6E6FA',
                    workout: '#C1E1C1'
                };
                return colors[activity] || '#C9E4FF';
            }
            
            function renderTodayTable() {
                let html = '';
                let totalTodaySeconds = 0;
                
                activities.forEach(activity => {
                    const seconds = totalSeconds[activity] || 0;
                    totalTodaySeconds += seconds;
                    
                    const maxSeconds = activity === 'work' ? 28800 : (activity === 'workout' ? 10800 : 7200); // 8 hours for work, 3 hours for workout, 2 hours for others
                    const progress = Math.min((seconds / maxSeconds) * 100, 100);
                    
                    html += `
                        <tr>
                            <td>
                                <div class="activity-cell">
                                    <div class="activity-icon ${activity}">${getActivityIcon(activity)}</div>
                                    <span>${getActivityName(activity)}</span>
                                </div>
                            </td>
                            <td class="duration-cell">${formatDuration(seconds)}</td>
                            <td class="progress-cell">
                                <div class="mini-progress-bar">
                                    <div class="mini-progress-fill ${activity}" style="width: ${progress}%"></div>
                                </div>
                            </td>
                        </tr>
                    `;
                });
                
                // Add total row
                html += `
                    <tr>
                        <td><strong>Total</strong></td>
                        <td class="total-time-cell">${formatDuration(totalTodaySeconds)}</td>
                        <td>-</td>
                    </tr>
                `;
                
                todayTableBody.innerHTML = html;
            }
            
            function renderProductivityChart() {
                const ctx = productivityChart.getContext('2d');
                
                // Get last 7 days
                const last7Days = [];
                const today = new Date();
                
                for (let i = 6; i >= 0; i--) {
                    const date = new Date(today);
                    date.setDate(date.getDate() - i);
                    last7Days.push(date.toDateString());
                }
                
                // Prepare data for chart
                const chartData = {
                    labels: [],
                    datasets: []
                };
                
                // Generate date labels
                last7Days.forEach(dateStr => {
                    const date = new Date(dateStr);
                    chartData.labels.push(date.toLocaleDateString('en-US', { day: 'numeric', month: 'short' }));
                });
                
                // Generate datasets for each activity
                activities.forEach(activity => {
                    const data = [];
                    const color = getActivityColor(activity);
                    
                    last7Days.forEach(dateStr => {
                        const dayData = dailyHistory.find(d => d.date === dateStr);
                        const seconds = dayData ? (dayData.activities[activity] || 0) : 0;
                        data.push(seconds / 3600); // Convert to hours
                    });
                    
                    chartData.datasets.push({
                        label: getActivityName(activity),
                        data: data,
                        backgroundColor: color,
                        borderColor: color,
                        borderWidth: 2,
                        borderRadius: 5,
                        barThickness: 20
                    });
                });
                
                // Clear previous chart
                ctx.clearRect(0, 0, productivityChart.width, productivityChart.height);
                
                // Draw chart manually (simple bar chart)
                const padding = 40;
                const chartWidth = productivityChart.width - padding * 2;
                const chartHeight = productivityChart.height - padding * 2;
                const barWidth = chartWidth / (chartData.labels.length * activities.length + chartData.labels.length - 1);
                const maxValue = Math.max(...chartData.datasets.flatMap(d => d.data));
                
                // Draw axes
                ctx.strokeStyle = '#ddd';
                ctx.lineWidth = 1;
                ctx.beginPath();
                ctx.moveTo(padding, padding);
                ctx.lineTo(padding, productivityChart.height - padding);
                ctx.lineTo(productivityChart.width - padding, productivityChart.height - padding);
                ctx.stroke();
                
                // Draw bars
                chartData.labels.forEach((label, labelIndex) => {
                    const x = padding + labelIndex * (barWidth * activities.length + barWidth);
                    
                    chartData.datasets.forEach((dataset, datasetIndex) => {
                        const value = dataset.data[labelIndex];
                        const barHeight = (value / maxValue) * chartHeight;
                        const barX = x + datasetIndex * barWidth;
                        const barY = productivityChart.height - padding - barHeight;
                        
                        ctx.fillStyle = dataset.backgroundColor;
                        ctx.fillRect(barX, barY, barWidth - 2, barHeight);
                    });
                });
                
                // Draw legend
                let legendHTML = '';
                activities.forEach(activity => {
                    legendHTML += `
                        <div class="legend-item">
                            <div class="legend-color" style="background: ${getActivityColor(activity)}"></div>
                            <span>${getActivityIcon(activity)} ${getActivityName(activity)}</span>
                        </div>
                    `;
                });
                chartLegend.innerHTML = legendHTML;
            }
            
            function renderHistoryTable() {
                if (dailyHistory.length === 0) {
                    historyTableBody.innerHTML = `
                        <tr>
                            <td colspan="7" class="empty-history">
                                <div class="empty-history-icon">üìù</div>
                                <p>No daily history yet. Data will appear after the day is complete.</p>
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                // Sort by date (newest first)
                const sortedHistory = [...dailyHistory].sort((a, b) => new Date(b.date) - new Date(a.date));
                
                let html = '';
                sortedHistory.forEach(day => {
                    const totalSeconds = activities.reduce((sum, act) => sum + (day.activities[act] || 0), 0);
                    
                    html += `
                        <tr>
                            <td class="date-cell">${formatDate(day.date)}</td>
                            <td>${formatDurationShort(day.activities.work || 0)}</td>
                            <td>${formatDurationShort(day.activities.study || 0)}</td>
                            <td>${formatDurationShort(day.activities.read || 0)}</td>
                            <td>${formatDurationShort(day.activities.film || 0)}</td>
                            <td>${formatDurationShort(day.activities.workout || 0)}</td>
                            <td class="total-time-cell">${formatDuration(totalSeconds)}</td>
                        </tr>
                    `;
                });
                
                historyTableBody.innerHTML = html;
            }
            
            function renderTimeHistory() {
                renderTodayTable();
                renderProductivityChart();
                renderHistoryTable();
            }
            
            function archiveDayData() {
                const today = new Date().toDateString();
                
                // Check if today's data has already been archived
                const alreadyArchived = dailyHistory.some(d => d.date === today);
                if (alreadyArchived) return;
                
                // Archive today's data
                const dayData = {
                    date: today,
                    activities: { ...totalSeconds }
                };
                
                dailyHistory.unshift(dayData);
                
                // Limit to only the last 30 days
                if (dailyHistory.length > 30) {
                    dailyHistory = dailyHistory.slice(0, 30);
                }
                
                saveUserData();
            }

            // --- DASHBOARD FUNCTIONS ---
            function updateClock() {
                const now = new Date();
                const h = String(now.getHours()).padStart(2, '0');
                const m = String(now.getMinutes()).padStart(2, '0');
                const s = String(now.getSeconds()).padStart(2, '0');
                document.getElementById('live-clock').textContent = `${h}:${m}:${s}`;
            }
            setInterval(updateClock, 1000);
            updateClock();

            function generateCalendar() {
                const now = new Date();
                const year = now.getFullYear();
                const month = now.getMonth();
                const today = now.getDate();
                const firstDay = new Date(year, month, 1).getDay();
                const daysInMonth = new Date(year, month + 1, 0).getDate();
                const monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
                let html = `<table><caption>${monthNames[month]} ${year}</caption><thead><tr>`;
                const dayNames = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];
                dayNames.forEach(day => html += `<th>${day}</th>`);
                html += `</tr></thead><tbody><tr>`;
                let date = 1;
                for (let i = 0; i < firstDay; i++) html += `<td></td>`;
                for (let i = firstDay; i < 7; i++) {
                    // Mark birthday in calendar
                    let className = '';
                    if (date === today) className = 'today';
                    else if (birthdayDate) {
                        const birthday = new Date(birthdayDate);
                        if (date === birthday.getDate() && month === birthday.getMonth()) {
                            className = 'birthday';
                        }
                    }
                    html += `<td ${className ? 'class="' + className + '"' : ''}>${date}</td>`; 
                    date++;
                }
                html += `</tr>`;
                while (date <= daysInMonth) {
                    html += `<tr>`;
                    for (let i = 0; i < 7; i++) {
                        if (date > daysInMonth) { html += `<td></td>`; }
                        else { 
                            // Mark birthday in calendar
                            let className = '';
                            if (date === today) className = 'today';
                            else if (birthdayDate) {
                                const birthday = new Date(birthdayDate);
                                if (date === birthday.getDate() && month === birthday.getMonth()) {
                                    className = 'birthday';
                                }
                            }
                            html += `<td ${className ? 'class="' + className + '"' : ''}>${date}</td>`; 
                            date++; 
                        }
                    }
                    html += `</tr>`;
                }
                html += `</tbody></table>`;
                document.getElementById('calendar-container').innerHTML = html;
            }
            generateCalendar();

            // --- NAVIGATION FUNCTIONS ---
            navLinks.forEach(link => {
                link.addEventListener('click', () => {
                    const targetId = link.dataset.target;
                    sections.forEach(section => section.classList.remove('active'));
                    document.getElementById(targetId).classList.add('active');
                    navLinks.forEach(l => l.classList.remove('active'));
                    link.classList.add('active');
                });
            });

            // --- TIME MANAGEMENT FUNCTIONS ---
            let timerInterval = null;
            let seconds = 0;
            let isTimerRunning = false;
            let isPaused = false;
            let currentActivity = 'work';

            function checkAndResetDaily() {
                const today = new Date().toDateString();
                if (lastResetDate !== today) {
                    // Archive previous day's data
                    if (lastResetDate) {
                        archiveDayData();
                    }
                    
                    activities.forEach(act => {
                        totalSeconds[act] = 0;
                    });
                    lastResetDate = today;
                    // Reset alarm status every new day
                    birthdayAlarmShown = false;
                    saveUserData();
                }
            }
            
            function saveUserData() {
                const dataToSave = {
                    totalSeconds: totalSeconds,
                    lastResetDate: lastResetDate,
                    transactions: transactions,
                    // Save image array to Firebase
                    dashboardImages: dashboardImages,
                    // Save profile picture URL to Firebase
                    profileImageUrl: profileImageUrl,
                    // Save birthday date to Firebase
                    birthdayDate: birthdayDate,
                    // Save alarm status
                    birthdayAlarmShown: birthdayAlarmShown,
                    // Save daily history
                    dailyHistory: dailyHistory
                };
                firebaseDB.ref('userData/' + currentUser).set(dataToSave);
            }

            activityBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    if (isTimerRunning || isPaused) {
                        stopTimer();
                    }
                    activityBtns.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentActivity = btn.dataset.activity;
                });
            });

            function handleStartPause() {
                if (!isTimerRunning && !isPaused) startTimer();
                else if (isTimerRunning && !isPaused) pauseTimer();
                else if (!isTimerRunning && isPaused) resumeTimer();
            }

            function startTimer() {
                isTimerRunning = true; isPaused = false;
                activityBtns.forEach(b => b.disabled = true);
                startPauseBtn.textContent = 'Pause'; stopTimerBtn.disabled = false;
                timerInterval = setInterval(() => { seconds++; updateTimerDisplay(); }, 1000);
            }
            function pauseTimer() {
                isTimerRunning = false; isPaused = true;
                clearInterval(timerInterval); startPauseBtn.textContent = 'Resume';
            }
            function resumeTimer() {
                isTimerRunning = true; isPaused = false;
                startPauseBtn.textContent = 'Pause';
                timerInterval = setInterval(() => { seconds++; updateTimerDisplay(); }, 1000);
            }
            function stopTimer() {
                if (!isTimerRunning && !isPaused) return;
                clearInterval(timerInterval);
                
                totalSeconds[currentActivity] += seconds;
                saveUserData();
                seconds = 0; isTimerRunning = false; isPaused = false;
                activityBtns.forEach(b => b.disabled = false);
                startPauseBtn.textContent = 'Start'; stopTimerBtn.disabled = true;
                updateTimerDisplay(); updateTimeDisplay(); updateProgressBar();
                
                // Update table and chart if currently displayed
                if (historyContent.classList.contains('show')) {
                    renderTimeHistory();
                }
            }
            function updateTimerDisplay() {
                const hrs = Math.floor(seconds / 3600);
                const mins = Math.floor((seconds % 3600) / 60);
                const secs = seconds % 60;
                timerDisplay.textContent = `${String(hrs).padStart(2, '0')}:${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
            }
            function updateTimeDisplay() {
                activities.forEach(act => {
                    const totalSecs = totalSeconds[act];
                    const hrs = Math.floor(totalSecs / 3600);
                    const mins = Math.floor((totalSecs % 3600) / 60);
                    const textEl = document.getElementById(timeTexts[act]);
                    if (act === 'work') textEl.textContent = `${hrs} Hours ${mins} Minutes`;
                    else textEl.textContent = `${hrs * 60 + mins} Minutes`;
                });
            }
            function updateProgressBar() {
                const workPerc = Math.min((totalSeconds['work'] / 28800) * 100, 100);
                document.getElementById(progressBars['work']).style.width = `${workPerc}%`;
                document.getElementById(progressBars['work']).textContent = `${workPerc.toFixed(1)}%`;
                const studyPerc = Math.min((totalSeconds['study'] / 1800) * 100, 100);
                document.getElementById(progressBars['study']).style.width = `${studyPerc}%`;
                document.getElementById(progressBars['study']).textContent = `${studyPerc.toFixed(1)}%`;
                const readPerc = Math.min((totalSeconds['read'] / 7200) * 100, 100);
                document.getElementById(progressBars['read']).style.width = `${readPerc}%`;
                document.getElementById(progressBars['read']).textContent = `${readPerc.toFixed(1)}%`;
                const filmPerc = Math.min((totalSeconds['film'] / 10800) * 100, 100);
                document.getElementById(progressBars['film']).style.width = `${filmPerc}%`;
                document.getElementById(progressBars['film']).textContent = `${filmPerc.toFixed(1)}%`;
                const workoutPerc = Math.min((totalSeconds['workout'] / 10800) * 100, 100);
                document.getElementById(progressBars['workout']).style.width = `${workoutPerc}%`;
                document.getElementById(progressBars['workout']).textContent = `${workoutPerc.toFixed(1)}%`;
            }
            function resetDay() {
                if (confirm("Are you sure you want to reset today's progress?")) {
                    activities.forEach(act => {
                        totalSeconds[act] = 0;
                    });
                    lastResetDate = new Date().toDateString();
                    saveUserData();
                    updateTimeDisplay(); updateProgressBar();
                    
                    // Update table if currently displayed
                    if (historyContent.classList.contains('show')) {
                        renderTodayTable();
                    }
                }
            }
            startPauseBtn.addEventListener('click', handleStartPause);
            stopTimerBtn.addEventListener('click', stopTimer);
            resetDayBtn.addEventListener('click', resetDay);

            // --- MONEY MANAGEMENT FUNCTIONS ---
            function formatRupiah(amount) { return 'Rp ' + amount.toLocaleString('id-ID'); }
            
            // Function to get current date in Indonesian format
            function getCurrentDate() {
                const now = new Date();
                const options = { day: 'numeric', month: 'long', year: 'numeric' };
                return now.toLocaleDateString('id-ID', options);
            }
            
            function addTransaction(type) {
                const amount = parseFloat(amountInput.value);
                const description = descriptionInput.value;
                if (!amount || !description) { 
                    alert('Amount and description must be filled!'); 
                    return; 
                }
                
                // Add current date to transaction
                const currentDate = getCurrentDate();
                
                const transaction = { 
                    id: Date.now(), 
                    type, 
                    amount, 
                    description,
                    date: currentDate // Add current date
                };
                
                transactions.unshift(transaction);
                saveUserData();
                moneyForm.reset(); 
                updateMoneySummary(); 
                displayTransactions();
            }
            
            function updateMoneySummary() {
                const income = transactions.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);
                const expense = transactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0);
                const balance = income - expense;
                totalIncomeEl.textContent = formatRupiah(income);
                totalExpenseEl.textContent = formatRupiah(expense);
                totalBalanceEl.textContent = formatRupiah(balance);
            }
            
            function displayTransactions() {
                if (transactions.length === 0) { 
                    transactionListEl.innerHTML = '<li class="transaction-item">No transactions yet.</li>'; 
                    return; 
                }
                
                transactionListEl.innerHTML = '';
                transactions.forEach(t => {
                    const li = document.createElement('li'); 
                    li.className = 'transaction-item';
                    const amountClass = t.type === 'income' ? 'amount-income' : 'amount-expense';
                    const amountSign = t.type === 'income' ? '+' : '-';
                    
                    li.innerHTML = `
                        <div class="transaction-details">
                            <div class="desc">${t.description}</div>
                            <div class="cat">${t.type === 'income' ? 'Income' : 'Expense'}</div>
                        </div>
                        <div class="transaction-date">${t.date || 'Date not available'}</div>
                        <div class="transaction-amount ${amountClass}">${amountSign} ${formatRupiah(t.amount)}</div>
                    `;
                    
                    transactionListEl.appendChild(li);
                });
            }
            
            moneyForm.addEventListener('submit', (e) => { 
                e.preventDefault(); 
                addTransaction('income'); 
            });
            
            addExpenseBtn.addEventListener('click', () => { 
                addTransaction('expense'); 
            });

            // --- PROFILE EVENT LISTENERS ---
            profilePicture.addEventListener('click', openProfileModal);
            changeProfileBtn.addEventListener('click', changeProfilePicture);
            closeModal.addEventListener('click', closeProfileModal);
            profileInput.addEventListener('change', handleProfilePictureChange);
            
            // Close modal if user clicks outside modal content
            window.addEventListener('click', (event) => {
                if (event.target === profileModal) {
                    closeProfileModal();
                }
            });

            // --- IMAGE GALLERY EVENT LISTENERS ---
            document.getElementById('add-image-btn').addEventListener('click', () => {
                document.getElementById('image-input').click();
            });
            
            document.getElementById('image-input').addEventListener('change', addImage);
            
            // --- BIRTHDAY EVENT LISTENERS ---
            editBirthdayBtn.addEventListener('click', openBirthdayModal);
            closeBirthdayModal.addEventListener('click', closeBirthdayModalFunc);
            cancelBirthdayBtn.addEventListener('click', closeBirthdayModalFunc);
            birthdayForm.addEventListener('submit', saveBirthday);
            
            // --- TIME HISTORY EVENT LISTENERS ---
            historyToggleBtn.addEventListener('click', () => {
                const isHidden = !historyContent.classList.contains('show');
                if (isHidden) {
                    historyContent.classList.add('show');
                    historyArrow.textContent = '‚ñ≤';
                    renderTimeHistory();
                } else {
                    historyContent.classList.remove('show');
                    historyArrow.textContent = '‚ñº';
                }
            });
            
            // Close modal if user clicks outside modal content
            window.addEventListener('click', (event) => {
                if (event.target === birthdayModal) {
                    closeBirthdayModalFunc();
                }
            });

            // --- INITIALIZATION ---
            const loggedInUser = localStorage.getItem('loggedInUser');
            console.log('User stored in localStorage:', loggedInUser);
            
            if (loggedInUser) {
                currentUser = loggedInUser;
                console.log('User already logged in, showing main app...');
                showMainApp();
                initializeUserData();
            } else {
                console.log('User not logged in, showing auth screen...');
                showAuthScreen();
            }
        });

    </script>

    <script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', function() {
      navigator.serviceWorker.register('/sw.js')
        .then(registration => {
          console.log('ServiceWorker registration successful with scope: ', registration.scope);
        })
        .catch(err => {
          console.log('ServiceWorker registration failed: ', err);
        });
    });
  }
</script>
</body>
</html>